<h1>Página de Pesquisa</h1>

<form id="search-form" method="get" action="{% url 'search' %}">
    <input id="search-input" type="text" name="q" placeholder="Buscar por nome ou área" value="{{ query }}" autocomplete="off">
    <button type="submit">Pesquisar</button>
    {% if query %}
        <p>Mostrando resultados para: "{{ query }}"</p>
    {% endif %}
</form>

<div id="results-container">
    {% include 'fazpramim/_search_results.html' %}
</div>

<script>
// Busca dinâmica: faz requisições enquanto o usuário digita (debounce simples)
(function(){
    const input = document.getElementById('search-input');
    const resultsContainer = document.getElementById('results-container');
    let timeout = null;

    function renderHTML(html){
        resultsContainer.innerHTML = html;
    }

    async function doSearch(q){
        const url = new URL(window.location.href);
        url.searchParams.set('q', q);
        // sinaliza como AJAX
        const resp = await fetch(url.toString(), {headers: {'X-Requested-With': 'XMLHttpRequest'}});
        if(resp.ok){
            const text = await resp.text();
            renderHTML(text);
        }
    }

    input.addEventListener('input', function(e){
        const q = e.target.value.trim();
        clearTimeout(timeout);
        timeout = setTimeout(function(){
            doSearch(q);
        }, 300);
    });
})();
</script>
