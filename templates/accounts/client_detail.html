{% extends 'base.html' %}

{% block content %}
<div style="max-width:900px; margin:2rem auto;">
    <p><a href="{% url 'home' %}">&larr; Voltar</a></p>

    <div style="background:#fff; padding:2rem; border-radius:12px; border:1px solid #ddd; margin-bottom:2rem;">
        <h1 style="margin:0 0 1rem 0;">Perfil do Cliente: {{ client.username }}</h1>

        <!-- Média de Avaliações -->
        {% if avg_rating %}
        <div style="padding:1rem; background:#FFF9E6; border:2px solid #FFC107; border-radius:8px; margin-bottom:1.5rem; text-align:center;">
            <div style="font-size:2.5rem; color:#FFC107; margin-bottom:0.5rem;">
                {% widthratio avg_rating 1 1 as stars_int %}
                {% for i in "12345" %}
                    {% if forloop.counter <= stars_int %}★{% else %}☆{% endif %}
                {% endfor %}
            </div>
            <p style="margin:0; font-size:1.2rem; font-weight:600; color:#333;">{{ avg_rating|floatformat:1 }} estrelas</p>
            <p style="margin:0.25rem 0 0 0; color:#666;">Baseado em {{ total_reviews }} avaliação{{ total_reviews|pluralize:"ões" }}</p>
        </div>
        {% else %}
        <div style="padding:1rem; background:#f0f0f0; border-radius:8px; margin-bottom:1.5rem; text-align:center;">
            <p style="margin:0; color:#666;">Ainda não há avaliações para este cliente</p>
        </div>
        {% endif %}

        {% if client_profile.full_name %}
        <p style="margin:0.75rem 0;"><strong>Nome:</strong> {{ client_profile.full_name }}</p>
        {% endif %}

        {% if client_profile.phone %}
        <p style="margin:0.75rem 0;"><strong>Telefone:</strong> {{ client_profile.phone }}</p>
        {% endif %}

        {% if client.email %}
        <p style="margin:0.75rem 0;"><strong>Email:</strong> {{ client.email }}</p>
        {% endif %}
    </div>

    <!-- Seção de Avaliações -->
    {% if reviews %}
    <div style="background:#fff; padding:2rem; border-radius:12px; border:1px solid #ddd;">
        <h2 style="margin:0 0 1.5rem 0; color:#333; border-bottom:2px solid #FFC107; padding-bottom:0.5rem;">Avaliações de Prestadores</h2>
        
        <div style="display:flex; flex-direction:column; gap:1.5rem;">
            {% for review in reviews %}
            <div style="padding:1.5rem; background:#f9f9f9; border-radius:8px; border-left:4px solid #FFC107;">
                <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:0.75rem;">
                    <div>
                        <p style="margin:0; font-weight:600; color:#333;">
                            <a href="{% url 'provider_detail' review.service_request.provider.pk %}" style="color:#4A90E2; text-decoration:none;">
                                {{ review.service_request.provider.full_name }}
                            </a>
                        </p>
                        <p style="margin:0.25rem 0 0 0; font-size:0.85rem; color:#666;">{{ review.provider_reviewed_at|date:"d/m/Y H:i" }}</p>
                    </div>
                    <div style="font-size:1.5rem; color:#FFC107;">
                        {% for i in "12345" %}
                            {% if forloop.counter <= review.provider_rating %}★{% else %}☆{% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% if review.provider_comment %}
                <p style="margin:0.75rem 0 0 0; color:#555; font-style:italic;">"{{ review.provider_comment }}"</p>
                {% endif %}
                <p style="margin:0.5rem 0 0 0; font-size:0.85rem; color:#999;">Serviço #{{ review.service_request.id }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}
